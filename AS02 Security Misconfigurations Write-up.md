AS02: Security Misconfigurations
Target: http://10.49.156.80:5002
Flag: THM{V3RB0S3_3RR0R_L34K}

1. บทนำ
แลปนี้เป็นการฝึกทดสอบช่องโหว่ประเภท Security Misconfiguration ซึ่งเกิดจากการตั้งค่าระบบไม่เหมาะสม โดยในแลปนี้พบว่า API เกี่ยวกับการจัดการผู้ใช้ถูกเปิดให้เข้าถึงได้โดยไม่ต้องมีการยืนยันตัวตน และระบบยังเปิดการแสดง error แบบละเอียด ทำให้ข้อมูลสำคัญรั่วไหลออกมาได้

2. สิ่งที่พบจากหน้าเว็บ
เมื่อเข้าเว็บไซต์หลักจะพบหน้าเว็บที่แสดงข้อมูลเกี่ยวกับ API โดยตรงดังนี้
    GET /api/user/<user_id>
    GET /api/user/123
    Retrieve user information by ID. User ID must be numeric.
มีการบอกว่า user_id ต้องเป็นตัวเลข ซึ่งเป็นการเปิดเผยข้อมูลภายในของระบบให้ผู้ใช้งานทั่วไปเห็น

3. การทดสอบ API พื้นฐาน
จากข้อมูลที่หน้าเว็บให้มา จึงลองเรียก API โดยใช้ curl เพื่อดึงข้อมูลผู้ใช้ตามหมายเลข ID ด้วยคำสั่งนี้
	for i in {1..10}; do 
        curl -s http://10.49.156.80:5002/api/user/$i
    done
ผลลัพธ์คือระบบตอบกลับข้อมูลผู้ใช้ทุกครั้ง แม้จะไม่ได้ทำการ login หรือยืนยันตัวตนใดๆ แสดงให้เห็นว่า API ไม่มีการป้องกันการเข้าถึง

4. การค้นหา Endpoint เพิ่มเติม
เพื่อดูว่ามี API อื่นที่เปิดอยู่หรือไม่ จึงใช้ gobuster เพื่อค้นหา endpoint เพิ่มเติมดังนี้
    gobuster dir \
    -u http://10.49.156.80:5002/ \
    -w /usr/share/seclists/Discovery/Web-Content/api/api-endpoints.txt \
    -t 30
พบ endpoint ที่น่าสนใจคือ
    /api/user/me
    /api/user/current
ซึ่งปกติควรใช้กับผู้ใช้ที่ login แล้ว

5. การเรียกใช้งาน Endpoint ที่ผิดพลาด
เมื่อทดลองเรียก endpoint ที่ได้ด้วยคำสั่ง
    curl -i http://10.49.156.80:5002/api/user/me
ระบบตอบกลับด้วย error และแสดงข้อมูล debug ออกมา โดยใน error message มี flag แสดงอยู่

6. Flag ที่ได้
จาก error message ที่ระบบแสดง ทำให้สามารถเห็น flag ได้โดยตรงคือ
    THM{V3RB0S3_3RR0R_L34K}

7. สรุปสิ่งที่ได้เรียนรู้
การตั้งค่าระบบที่ไม่เหมาะสมสามารถทำให้ข้อมูลสำคัญรั่วไหลได้
การเปิด debug หรือ error message แบบละเอียดในระบบจริงเป็นสิ่งที่อันตราย
แม้จะไม่ได้โจมตีระบบด้วยเทคนิคซับซ้อน แต่การลองเรียก API ที่ไม่ควรเปิดก็สามารถนำไปสู่การได้ข้อมูลสำคัญได้
